# 一、数据字典导入接口开发

## 1、创建读取监听器

```java


package com.atguigu.yygh.cmn.istener;

import com.alibaba.excel.context.AnalysisContext;
import com.alibaba.excel.event.AnalysisEventListener;
import com.atguigu.yygh.cmn.mapper.DictMapper;
import com.atguigu.yygh.model.cmn.Dict;
import com.atguigu.yygh.vo.cmn.DictEeVo;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import org.springframework.beans.BeanUtils;

/**
 * @author Henry Guan
 * @description 字典读取监听器
 * @since 2023-03-24
 */

public class DictListener extends AnalysisEventListener<DictEeVo> {
    private DictMapper dictMapper;

    public DictListener(DictMapper dictMapper) {
        this.dictMapper = dictMapper;
    }

    @Override
    public void invoke(DictEeVo dictEeVo, AnalysisContext analysisContext) {
        Dict dict = new Dict();
        BeanUtils.copyProperties(dictEeVo,dict);
        QueryWrapper<Dict> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("id",dictEeVo.getId());
        Integer count = this.dictMapper.selectCount(queryWrapper);
        if (count > 0) {
            this.dictMapper.updateById(dict);
        } else {
            this.dictMapper.insert(dict);
        }
    }

    @Override
    public void doAfterAllAnalysed(AnalysisContext analysisContext) {

    }
}

```

## 2、添加controller方法

```java
@PostMapping(value = "/upload")
    public R upload(MultipartFile file) throws IOException {
        dictService.upload(file);
        return R.ok();
    }
```

## 3、添加service方法

```java
 @Override
    public void upload(MultipartFile file) throws IOException {
        EasyExcel.read(file.getInputStream(),DictEeVo.class,new DictListener(baseMapper)).sheet(0).doRead();
    }
```

# 二、数据字典导入前端

1、在list.vue页面添加导入按钮

```js
<el-button type="text" @click="importData"><i class="fa fa-plus"/> 导入</el-button>
```

2、添加导入弹出层

```js
<el-dialog title="导入" :visible.sync="dialogImportVisible" width="480px">
            <el-form label-position="right" label-width="170px">
                <el-form-item label="文件">
                    <el-upload
                            :multiple="false"
                            :on-success="onUploadSuccess"
                            :action="'http://localhost:9001/admin/cmn/upload'"
                            class="upload-demo">
                        <el-button size="small" type="primary">点击上传</el-button>
                        <div slot="tip" class="el-upload__tip">只能上传xls文件，且不超过500kb</div>
                    </el-upload>
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @click="dialogImportVisible = false">取消</el-button>
            </div>
        </el-dialog>
```

3、添加导入弹出层属性

```js
 return {
            dialogImportVisible:false,
        }
```

4、添加导入方法

```js
 importData() {
            this.dialogImportVisible = true;
        },
        onUploadSuccess() {
            this.$message.success('上传成功');
            dict.getChildListByPid(1).then(resp => {
                this.list=resp.data.items;
            })
            this.dialogImportVisible = false;
        }
```
